---
import { Menu, X } from "@lucide/astro";
import Button from "@components/ui/Button.astro";

interface NavItem {
  label: string;
  href: string;
}

const navItems: NavItem[] = [
  { label: "about", href: "#" },
  { label: "experience", href: "#experience" },
  { label: "work", href: "#work" },
  { label: "posts", href: "#posts" },
  { label: "contact", href: "#contact" },
];
---

<header
  id="site-header"
  class="fixed top-0 left-0 right-0 z-50 transition-all duration-500 bg-transparent"
>
  <div class="container mx-auto px-6">
    <nav class="flex items-center justify-between h-[72px]">
      {/* Logo/Brand */}
      <button
        id="logo-btn"
        data-href="#"
        class="text-2xl font-bold text-gradient hover:opacity-80 transition-all duration-300"
        style="font-family: 'Outfit', sans-serif;"
      >
        JM
      </button>

      {/*Desktop Navigation */}
      <div class="hidden md:flex items-center justify-center gap-10">
        {navItems.map((item) => (
          <button
            data-href={item.href}
            class="nav-link hover:cursor-pointer text-gray-300 hover:text-white transition-all duration-300 text-sm font-medium relative group tracking-wide"
            style="font-family: 'Outfit', sans-serif;"
          >
            {item.label}
            <span class="absolute -bottom-1 left-0 w-0 h-0.5 bg-gradient-to-r from-amber-400 to-amber-500 transition-all duration-300 group-hover:w-full"></span>
          </button>
        ))}
      </div>

      {/* Mobile Menu Button */}
      <Button
        variant="ghost"
        size="icon"
        class="md:hidden text-gray-300 hover:text-amber-400"
        id="mobile-menu-btn"
      >
        <Menu class="h-5 w-5" id="menu-icon" />
        <X class="h-5 w-5 hidden" id="close-icon" />
      </Button>
    </nav>

    {/* Mobile Navigation */}
    <div
      id="mobile-menu"
      class="md:hidden fixed top-[72px] right-0 w-56 border-l border-amber-500/20 pb-4 animate-in fade-in slide-in-from-right-2 duration-300 hidden"
    >
      <div class="flex flex-col pt-2 backdrop-blur-md bg-[#030712]/80">
        {navItems.map((item) => (
          <button
            data-href={item.href}
            class="nav-link hover:cursor-pointer block w-full text-center py-4 px-6 text-gray-300 hover:text-white hover:bg-amber-500/10 transition-all duration-300 font-medium"
            style="font-family: 'Outfit', sans-serif;"
          >
            {item.label}
          </button>
        ))}
      </div>
    </div>
  </div>
</header>


<script>
  function setupHeaderBehavior() {
    const header = document.getElementById("site-header");
    const menuBtn = document.getElementById("mobile-menu-btn");
    const mobileMenu = document.getElementById("mobile-menu");
    const menuIcon = document.getElementById("menu-icon");
    const closeIcon = document.getElementById("close-icon");
    const logoBtn = document.getElementById("logo-btn");
    const navLinks = document.querySelectorAll(".nav-link");

    let isMobileMenuOpen = false;

    function updateHeaderOnScroll() {
      if (window.scrollY > 20) {
        header?.classList.add(
          "bg-[#030712]/80",
          "backdrop-blur-md",
          "shadow-sm",
          "border-b",
          "border-amber-500/10"
        );
        header?.classList.remove("bg-transparent");
      } else {
        header?.classList.remove(
          "bg-[#030712]/80",
          "backdrop-blur-md",
          "shadow-sm",
          "border-b",
          "border-amber-500/10"
        );
        header?.classList.add("bg-transparent");
      }
    }

    function initializeHeaderState() {
      updateHeaderOnScroll();
      setTimeout(updateHeaderOnScroll, 0);
    }

    window.addEventListener("scroll", updateHeaderOnScroll);
    window.addEventListener("load", initializeHeaderState);

    function scrollToSection(href: string) {
      if (href === "#") {
        window.scrollTo({ top: 0, behavior: "smooth" });
      } else {
        const element = document.querySelector(href);
        if (element) element.scrollIntoView({ behavior: "smooth" });
      }
      closeMenu();
    }

    logoBtn?.addEventListener("click", () => scrollToSection("#"));
    navLinks.forEach((link) => {
      const href = link.getAttribute("data-href");
      if (href) link.addEventListener("click", () => scrollToSection(href));
    });

    menuBtn?.addEventListener("click", () => {
      isMobileMenuOpen = !isMobileMenuOpen;
      if (isMobileMenuOpen) {
        mobileMenu?.classList.remove("hidden");
        menuIcon?.classList.add("hidden");
        closeIcon?.classList.remove("hidden");
      } else {
        closeMenu();
      }
    });

    function closeMenu() {
      isMobileMenuOpen = false;
      mobileMenu?.classList.add("hidden");
      menuIcon?.classList.remove("hidden");
      closeIcon?.classList.add("hidden");
    }
  }

  // Ejecutar en carga inicial y en cada navegaci√≥n SPA
  document.addEventListener("astro:page-load", setupHeaderBehavior);
</script>
